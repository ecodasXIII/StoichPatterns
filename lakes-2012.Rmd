---
title: "Lakes 2012 nars data"
output: html_document
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(FedData)
library(raster)
library(sf)
library(leaflet)
library(readr)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
theme_set(theme_bw())

nars_data = read_csv("data/nars_data_table.csv");nars_data$filename <- basename(nars_data$data_link)
```

Survey names
```{r, echo = F}
nars_data %>% pull(Survey) %>% unique()
```

```{r}
nars_data %>% 
  filter(Survey == "Lakes 2012") %>%
  pull(Indicator) %>% unique()
```

water chemistry data (DOC, TN, and TP). 2 files for chemistry - site data and actual chemistry

```{r, echo = F, include = F}
lakes2012_wc1 <- nars_data %>% 
  filter(Survey == "Lakes 2012",
         Indicator == "Water Chemistry") %>%
  pull(filename) %>% '[[' (1) %>% # metadata 
  paste0("raw-data/", .) %>%
  read_csv()
lakes2012_wc2 <- nars_data %>% 
  filter(Survey == "Lakes 2012",
         Indicator == "Water Chemistry") %>%
  pull(filename) %>% '[[' (2) %>% # chemistry data 
  paste0("raw-data/", .) %>%
  read_csv()
```

lakes2012_wc1 = H<sup>2</sup>O chem metadata  
lakes2012_wc2 = H<sup>2</sup>O chem data

```{r, echo = F}
names(lakes2012_wc2)
```

```{r variable select}
lakevars <- c("UID", "SITE_ID", "DATE_COL", "DOC_RESULT", "DOC_QA_FLAG", "NTL_RESULT", "NTL_QA_FLAG", "PTL_RESULT", "PTL_QA_FLAG")
```

Grab the follow variables:

-UID -> unique ID  
-SITE_ID -> site ID  
-DATE_COL -> date collected  
-DOC_RESULT -> DOC measurement mg/L  
-DOC_QA_FLAG -> DOC QA/QC flag  
-NTL_RESULT -> total N result mg/L  
-NTL_QA_FLAG -> total N QA/QC flag  
-PTL_RESULT -> total P result mg/L  
-PTL_QA_FLAG -> total P QA/QC flag  

Create new CNP data frame

```{r, include = F}

lakes2012_meta <- dplyr::select(lakes2012_wc1, one_of(lakevars)) %>%
  unique()
lakes2012_data <- dplyr::select(lakes2012_wc2, one_of(lakevars))

lakes2012_CNP <- inner_join(lakes2012_data, lakes2012_meta) %>%
  mutate(PTL_RESULT = PTL_RESULT/1000)
```

```{r exploratory plots, echo = F, include = F}
ggplot(lakes2012_CNP, aes(x = log10(DOC_RESULT))) + geom_histogram() + ggtitle("DOC range") + xlab("log10(DOC mg/L)") +
  theme(panel.grid = element_blank(), axis.title.y = element_blank()) 

ggplot(lakes2012_CNP, aes(x = log10(NTL_RESULT))) + geom_histogram() +
  ggtitle("TN range") + xlab("log10(TN mg/L)") +
  theme(panel.grid = element_blank(), axis.title.y = element_blank())

ggplot(lakes2012_CNP, aes(x = log10(PTL_RESULT))) + geom_histogram() +
  ggtitle("TP range") + xlab("log10(TP mg/L)") +
  theme(panel.grid = element_blank(), axis.title.y = element_blank())


```

What is the distribution of collection dates?

```{r, include = F, echo = F}
lakes2012_CNP <- lakes2012_CNP %>%
  mutate(date_formatted = as.Date(DATE_COL, format = "%d-%b-%y")) 

ggplot(lakes2012_CNP, aes(x = date_formatted)) + geom_histogram()
```



